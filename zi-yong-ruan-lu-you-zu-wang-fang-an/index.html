<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
            <title>自用软路由组网方案 - I&#x27;m Win! </title>
        <meta name="description" content="自用软路由组网方案, I'm Win!, Winrich" />
         
        <meta name="generator" content="Publii Open-Source CMS for Static Site" />
<link rel="stylesheet" href="https://imwin.org/media/plugins/syntaxHighlighter/prism-beige.css" />

				<!-- Global site tag (gtag.js) - Google Analytics -->
				<script 
					type="text/javascript"
					async 
					src="https://www.googletagmanager.com/gtag/js?id=G-BWJ3MTP20W"></script>
				<script type="text/javascript">
				  window.dataLayer = window.dataLayer || [];
				  function gtag(){dataLayer.push(arguments);}
				  gtag('js', new Date());
				  gtag('config', 'G-BWJ3MTP20W' );
				  
				</script>				
				
        <link rel="canonical" href="https://imwin.org/zi-yong-ruan-lu-you-zu-wang-fang-an/">
        <link rel="alternate" type="application/atom+xml" href="https://imwin.org/feed.xml" />
<link rel="alternate" type="application/json" href="https://imwin.org/feed.json" />

        
	        <link rel="shortcut icon" href="https://imwin.org/media/website/barchartasc2.svg" type="image/x-icon" />
        <link rel="stylesheet" href="https://imwin.org/assets/css/style.css?v=b66ecd39f30c72a839a9d8a0b53176e9">
        <script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://imwin.org/zi-yong-ruan-lu-you-zu-wang-fang-an/"},"headline":"自用软路由组网方案","datePublished":"2023-09-10T21:23","dateModified":"2023-09-10T21:26","description":"自用软路由组网方案, I'm Win!, Winrich","author":{"@type":"Person","name":"Winrich","url":"https://imwin.org/authors/winrcih/"},"publisher":{"@type":"Organization","name":"Winrich"}}</script>
        
        <noscript>
            <style>
                img[loading] {
                    opacity: 1;
                }
            </style>
        </noscript>	
        
    </head>
    <body>
        <div class="site-container">
   <header class="top" id="js-header">
      <a class="logo" href="https://imwin.org/">
            I&#x27;m Win!
      </a>
            <nav class="navbar js-navbar">
               <button
                  class="navbar__toggle js-toggle"
                  aria-label="Menu"
                  aria-haspopup="true"
                  aria-expanded="false">
                  <span class="navbar__toggle-box">
                     <span class="navbar__toggle-inner">Menu</span>
                  </span>
               </button>
             <ul class="navbar__menu">
                      <li>
                        <a
                           href="https://imwin.org/"
                              target="_self"
         >
                           首页
                       </a>
         
                  </li>
                      <li>
                        <a
                           href="https://imwin.org/tags/"
                              target="_self"
         >
                           所有标签
                       </a>
         
                  </li>
                      <li>
                        <a
                           href="https://imwin.org/tags/shou-cang-jia/"
                              target="_self"
         >
                           收藏夹
                       </a>
         
                  </li>
                      <li>
                        <a
                           href="https://imwin.org/about-me/"
                              target="_self"
         >
                           关于
                       </a>
         
                  </li>
             </ul>
            </nav>
   </header>
<main>
      <article class="post">
         <div class="hero">
             
             
            <header class="hero__content">
               <div class="wrapper">
                     <div class="post__meta">
                        <time datetime="2023-09-10T21:23">
                              Sep 10, 2023
                        </time>
                     </div>
                  <h1>
                     自用软路由组网方案
                  </h1>
                     <div class="post__meta post__meta--author">
                           <a href="https://imwin.org/authors/winrcih/" class="feed__author">Winrich</a>
                     </div>
               </div>
            </header>
         </div>

         <div class="wrapper post__entry">           
            <h2 id="组网需求">组网需求</h2>
<ol>
<li>公寓租客上网</li>
<li>自用科学环境</li>
<li>家庭成员环境</li>
<li>同轴模拟监控转网络</li>
</ol>
<h2 id="解决办法">解决办法</h2>
<ol>
<li>公共环境需要安全稳定运行，如果主路由用 openwrt 我怕自己忍不住折腾它，ROS 不会，直接采用 ikuai + 双 openwrt (主路由 ikuai,旁路网关,DNS).</li>
<li>自用科学直接采用最简单的方案买一个 CN2 GIA 线路，配置采用傻瓜插件 <a href="https://github.com/mack-a/v2ray-agent">https://github.com/mack-a/v2ray-agent</a> ,客户端用的是 HomeProxy .</li>
<li>家庭成员需求包括备份照片与视频，小孩使用 chatgpt 等，同时需要屏蔽 18+ 内容，就需要自建 DNS 用的方案是 Mosdns .</li>
<li>老式模拟摄像头不想布线，当时采用集中供电，所以有 一条供电线 + 同轴 可以拼出 4 根线，做一个 4 芯网线可以 100M .</li>
</ol>
<h2 id="硬件方案">硬件方案</h2>
<ul>
<li>电信双光纤入户 1000M + 300M</li>
<li>HP T620 Plus + HP NC364T 4 port + Mini PCIe 千兆(拆掉 VGA 接口安装)</li>
<li>TP-Link 24 port 千兆交换机</li>
<li>绿联双盘位外置硬盘座 + 2 块旧硬盘 （轻 NAS 盘）</li>
<li>TP-LINK TL-NV6116C-L + 4T 旧硬盘 + 淘宝山寨网络 400W 摄像头</li>
</ul>
<h2 id="设置与注意点">设置与注意点</h2>
<ul>
<li>主路由：<ul>
<li>安装爱快，双线接入 4 口网卡 1,2 口，设置 wan1 wan2</li>
<li>设置 LAN1 桥接其它 4 个端口</li>
<li>设置 DNS 地址分别为 2 个光猫的内网 IP , <font color="#c00000">DNS 代理不要开启</font></li>
<li>设置 DHCP 网关为 爱快 LAN1 地址，DNS 为 自建 DNS 服务器址。</li>
<li>设置 静态 IP 需要科学上网的网关为旁路网关(旁路由)</li>
<li>新建 2 个虚拟机，CPU 选 1 核，内存 512 就行</li>
</ul>
</li>
<li>旁路网关(旁路由)：<ul>
<li>安装 <a href="https://downloads.immortalwrt.org/">https://downloads.immortalwrt.org/</a> 最新版就行</li>
<li>在软件包删除 dnsmsaq 即在网络选项中没有 DHCP/DNS 这一项</li>
<li>接口建议使用 eth0，可以删除桥接 br-lan</li>
<li>LAN 接口设置网关为 主路由地址，DNS 地址为 自建 DNS 服务器</li>
<li>在软件包中安装 HomeProxy</li>
<li>HomeProxy 设置 DNS 为 <font color="#c00000">WAN 下发 DNS</font> ,国内 DNS 默认<font color="#c00000">禁用</font></li>
<li>添加节点后启用</li>
</ul>
</li>
<li>DNS 服务器设置<ul>
<li>安装 <a href="https://downloads.immortalwrt.org/">https://downloads.immortalwrt.org/</a></li>
<li>同样删除 dnsmsaq</li>
<li>接口设置网关同上，DNS 地址为 127.0.0.1 (MOSDNS 设置前为运营商地址)</li>
<li>软件包安装 MosDNS 软件包可能没有 LUCI <a href="https://github.com/sbwml/luci-app-mosdns">https://github.com/sbwml/luci-app-mosdns</a> 这里下载</li>
<li>MosDNS 设置 <font color="#c00000">监听端口为 53 ，目的是接管默认 DNS 端口</font></li>
<li>上游 DNS 随便选，远程 DNS 即科学 DNS 我设置是 1.1.1.3</li>
<li>MosDNS 设置黑名单屏蔽 18+内容，具体列表在清单中</li>
</ul>
</li>
</ul>
<h2 id="总结">总结</h2>
<p>这个方案只适合我，不一定适合所有人，希望能有所启发。</p>
<p>爱快的 DNS 在不开启代理的情况下，只为爱快本身使用，也就是当客户机的 DNS 地址指向爱快时，才发生作用。
想避免这个情况就开启爱快代理，模式选择第三方，地址填 MOSDNS 的。</p>
<p>双 OP 模式，主要就是为了稳定，再就是防止 DNS 泄漏，通过 <a href="https://ipleak.net">https://ipleak.net</a> 检测。只要检测不到你所在国家的地址即没有泄漏。</p>
<p>同轴改网线，单纯就是为了节约成本，事实证明可行，很多消费其实是无意义的。</p>
            
         </div>

            <footer class="wrapper post__footer">

                     <p class="post__last-updated">
                        This article was updated on
                           Sep 10, 2023
                     </p>

                     <ul class="post__tag">
                           <li>
                              <a href="https://imwin.org/tags/shou-cang-jia/">收藏夹</a>
                           </li>
                     </ul>

                  <div class="post__share">
                     
                     
                     
                     
                     
                     
                  </div>

                  <div class="post__bio bio">
                        <div>
                           <h3 class="bio__name">
                              <a href="https://imwin.org/authors/winrcih/" rel="author">Winrich</a>
                           </h3>
                              <div class="bio__desc">
                                 <p>40岁的中年男，想在这个人世间留下点什么。</p>
                              </div>
                        </div>
                  </div>
            </footer>
      </article>

            <nav class="post__nav">
               <div class="post__nav-inner">
                     <div class="post__nav-prev">
                        <svg width="1.041em" height="0.416em" aria-hidden="true">
                           <use xlink:href="https://imwin.org/assets/svg/svg-map.svg#arrow-prev"/>
                        </svg>

                        <a href="https://imwin.org/tong-guo-tian-jia-hostjie-jue-emby-jellyfin-tmmgua-bu-dong-de-wen-ti/" class="post__nav-link" rel="prev">
                           <span>Previous</span>
                           通过添加HOST解决emby jellyfin TMM刮不动的问题
                        </a>
                     </div>
               </div>
            </nav>


         <div class="post__comments">
            <div class="wrapper">
               
            </div>
         </div>


</main>
<footer class="footer">
        <div class="footer__copyright">
            <p>Powered by Publii</p>
        </div>
        <button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top">
            <svg>
                <use xlink:href="https://imwin.org/assets/svg/svg-map.svg#toparrow"/>
            </svg>
        </button>

</footer>
</div>

<script defer src="https://imwin.org/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script>

<script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script>

    <script>        
        var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }
    </script>


<script defer src="https://imwin.org/media/plugins/syntaxHighlighter/prism.js"></script>
</body>
</html>
